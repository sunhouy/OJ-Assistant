<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åœ¨çº¿è¯„æµ‹ç³»ç»Ÿ</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.5/codemirror.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.5/theme/monokai.min.css">
    <style>
        /* æ ·å¼ä¿æŒä¸å˜ï¼Œä¸åŸå§‹ä»£ç ç›¸åŒ */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: #f5f7fa;
            color: #333;
            line-height: 1.6;
        }

        .container {
            display: flex;
            flex-direction: column;
            height: 100vh;
            max-width: 1800px;
            margin: 0 auto;
        }

        header {
            background: linear-gradient(135deg, #1a237e 0%, #283593 100%);
            color: white;
            padding: 15px 25px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            flex-shrink: 0;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .logo h1 {
            font-size: 1.8rem;
            font-weight: 700;
        }

        .header-controls {
            display: flex;
            gap: 15px;
            align-items: center;
            flex-wrap: wrap;
        }

        .difficulty-control {
            display: flex;
            align-items: center;
            gap: 8px;
            background-color: rgba(255, 255, 255, 0.1);
            padding: 8px 15px;
            border-radius: 20px;
        }

        .difficulty-label {
            font-size: 0.9rem;
            opacity: 0.9;
        }

        .difficulty-input {
            width: 60px;
            padding: 5px 10px;
            border: none;
            border-radius: 4px;
            background-color: white;
            color: #333;
            font-weight: 600;
            text-align: center;
        }

        .difficulty-input:focus {
            outline: 2px solid #3949ab;
        }

        .status-bar {
            display: flex;
            gap: 25px;
            align-items: center;
        }

        .status-item {
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .status-label {
            font-size: 0.85rem;
            opacity: 0.8;
        }

        .status-value {
            font-size: 1.2rem;
            font-weight: 600;
        }

        .warning-badge {
            background-color: #ff5252;
            color: white;
            padding: 5px 12px;
            border-radius: 20px;
            font-weight: 600;
            display: none;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(255, 82, 82, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(255, 82, 82, 0); }
            100% { box-shadow: 0 0 0 0 rgba(255, 82, 82, 0); }
        }

        .main-content {
            display: flex;
            flex: 1;
            padding: 20px;
            gap: 20px;
            overflow: hidden;
            min-height: 0;
        }

        .problem-section {
            flex: 1;
            background-color: white;
            border-radius: 10px;
            padding: 25px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
            overflow-y: auto;
            display: flex;
            flex-direction: column;
        }

        .problem-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .problem-title {
            font-size: 1.6rem;
            color: #1a237e;
            margin-bottom: 0;
        }

        .problem-desc {
            margin-bottom: 25px;
        }

        .section-title {
            font-size: 1.2rem;
            color: #3949ab;
            margin: 20px 0 10px 0;
        }

        .code-section {
            flex: 2;
            display: flex;
            flex-direction: column;
            background-color: white;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
            overflow: hidden;
        }

        .code-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 25px;
            background-color: #1a237e;
            color: white;
        }

        .code-header h3 {
            font-size: 1.3rem;
        }

        .language-selector {
            background-color: #283593;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 5px;
            font-weight: 600;
        }

        .code-editor {
            flex: 1;
            overflow: hidden;
        }

        .CodeMirror {
            height: 100% !important;
            font-size: 16px;
        }

        .actions-section {
            display: flex;
            gap: 15px;
            padding: 20px;
            background-color: #f9f9f9;
            border-top: 1px solid #eee;
        }

        .btn {
            padding: 12px 25px;
            border: none;
            border-radius: 6px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 1rem;
        }

        .btn-primary {
            background-color: #3949ab;
            color: white;
        }

        .btn-primary:hover {
            background-color: #303f9f;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }

        .btn-secondary {
            background-color: #e8eaf6;
            color: #3949ab;
        }

        .btn-secondary:hover {
            background-color: #c5cae9;
        }

        .btn-danger {
            background-color: #ff5252;
            color: white;
        }

        .btn-danger:hover {
            background-color: #ff1744;
        }

        .btn-success {
            background-color: #4caf50;
            color: white;
        }

        .btn-success:hover {
            background-color: #388e3c;
        }

        .btn-ai {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-ai:hover {
            background: linear-gradient(135deg, #5a6fd8 0%, #6a4190 100%);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }

        /* æ¨¡æ€æ¡†æ ·å¼ */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            background-color: white;
            padding: 30px;
            border-radius: 10px;
            max-width: 700px;
            width: 90%;
            max-height: 85vh;
            overflow-y: auto;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid #eee;
        }

        .modal-title {
            font-size: 1.5rem;
            color: #1a237e;
        }

        .close-modal {
            background: none;
            border: none;
            font-size: 1.8rem;
            color: #999;
            cursor: pointer;
            line-height: 1;
        }

        .close-modal:hover {
            color: #333;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #555;
        }

        .form-control {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 1rem;
        }

        .form-control:focus {
            outline: none;
            border-color: #3949ab;
            box-shadow: 0 0 0 2px rgba(57, 73, 171, 0.2);
        }

        textarea.form-control {
            min-height: 100px;
            resize: vertical;
        }

        .test-case {
            margin-bottom: 15px;
            padding: 15px;
            background-color: white;
            border-radius: 6px;
            border-left: 4px solid #e8eaf6;
        }

        .test-case.passed {
            border-left-color: #4caf50;
        }

        .test-case.failed {
            border-left-color: #ff5252;
        }

        .test-case-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
        }

        .test-case-title {
            font-weight: 600;
        }

        .test-case-status {
            font-weight: 600;
            padding: 3px 10px;
            border-radius: 15px;
            font-size: 0.85rem;
        }

        .status-passed {
            background-color: #e8f5e9;
            color: #2e7d32;
        }

        .status-failed {
            background-color: #ffebee;
            color: #c62828;
        }

        .test-case-details {
            font-family: monospace;
            background-color: #f5f5f5;
            padding: 10px;
            border-radius: 4px;
            margin-top: 8px;
            font-size: 0.9rem;
            white-space: pre-wrap;
        }

        .problem-list {
            margin-top: 20px;
            border-top: 1px solid #eee;
            padding-top: 20px;
        }

        .problem-list h4 {
            color: #3949ab;
            margin-bottom: 15px;
        }

        .problem-list-item {
            padding: 10px 15px;
            margin-bottom: 10px;
            background-color: #f9f9f9;
            border-radius: 6px;
            cursor: pointer;
            transition: background-color 0.2s;
            border-left: 4px solid #e8eaf6;
        }

        .problem-list-item:hover {
            background-color: #e8eaf6;
        }

        .problem-list-item.active {
            background-color: #e8eaf6;
            border-left-color: #3949ab;
        }

        .problem-list-item.ai-generated {
            border-left-color: #764ba2;
        }

        .problem-list-title {
            font-weight: 600;
            margin-bottom: 5px;
        }

        .problem-list-desc {
            font-size: 0.9rem;
            color: #666;
        }

        .ai-tag {
            display: inline-block;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            font-size: 0.7rem;
            padding: 2px 8px;
            border-radius: 10px;
            margin-left: 8px;
            vertical-align: middle;
        }

        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 2000;
        }

        .loading-spinner {
            width: 50px;
            height: 50px;
            border: 5px solid #f3f3f3;
            border-top: 5px solid #3949ab;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .difficulty-display {
            display: inline-block;
            margin-left: 10px;
            font-size: 0.9rem;
            background-color: #e8eaf6;
            padding: 2px 8px;
            border-radius: 10px;
            color: #3949ab;
        }

        .difficulty-1 { background-color: #e8f5e9; color: #2e7d32; }
        .difficulty-2 { background-color: #f1f8e9; color: #558b2f; }
        .difficulty-3 { background-color: #f9fbe7; color: #9e9d24; }
        .difficulty-4 { background-color: #fffde7; color: #f9a825; }
        .difficulty-5 { background-color: #fff3e0; color: #ef6c00; }
        .difficulty-6 { background-color: #fbe9e7; color: #d84315; }
        .difficulty-7 { background-color: #ffebee; color: #c62828; }
        .difficulty-8 { background-color: #fce4ec; color: #ad1457; }
        .difficulty-9 { background-color: #f3e5f5; color: #6a1b9a; }
        .difficulty-10 { background-color: #e8eaf6; color: #283593; }

        footer {
            text-align: center;
            padding: 15px;
            background-color: #e8eaf6;
            color: #5c6bc0;
            font-size: 0.9rem;
            flex-shrink: 0;
        }

        @media (max-width: 1200px) {
            .main-content {
                flex-direction: column;
            }

            .problem-section, .code-section {
                width: 100%;
            }

            .header-controls {
                flex-direction: column;
                align-items: flex-end;
                gap: 10px;
            }
        }

        /* å®‰å…¨é˜²æŠ¤æ ·å¼ */
        .security-warning {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: #000;
            color: #ff0000;
            z-index: 9999;
            display: none;
            justify-content: center;
            align-items: center;
            font-size: 2rem;
            font-weight: bold;
            text-align: center;
            padding: 20px;
        }

        .security-warning.active {
            display: flex;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="logo">
                <h1>åœ¨çº¿è¯„æµ‹ç³»ç»Ÿ - å®‰å…¨æ¨¡å¼</h1>
            </div>
            <div class="header-controls">
                <div class="difficulty-control">
                    <span class="difficulty-label">éš¾åº¦ï¼ˆ1-10ï¼‰:</span>
                    <input type="number" id="difficultyInput" class="difficulty-input" min="1" max="10" value="1">
                    <button class="btn btn-ai" id="generateAIProblemBtn">AIç”Ÿæˆé¢˜ç›®</button>
                </div>
                <div class="status-bar">
                    <div class="status-item">
                        <span class="status-label">åˆ‡å±æ¬¡æ•°</span>
                        <span id="switchCount" class="status-value">0</span>
                    </div>
                    <div class="status-item">
                        <span class="status-label">å®‰å…¨çŠ¶æ€</span>
                        <span id="securityStatus" class="status-value" style="color: #4caf50;">å®‰å…¨</span>
                    </div>
                </div>
                <button class="btn btn-success" id="addProblemBtn">æ‰‹åŠ¨æ·»åŠ é¢˜ç›®</button>
                <button class="btn btn-secondary" id="fullscreenBtn">å…¨å±æ¨¡å¼</button>
                <div id="warningBadge" class="warning-badge">æ£€æµ‹åˆ°å¼‚å¸¸è¡Œä¸ºï¼</div>
            </div>
        </header>

        <div class="main-content">
            <div class="problem-section">
                <div class="problem-header">
                    <h2 id="problemTitle" class="problem-title">1. A + B é—®é¢˜</h2>
                    <div>
                        <span class="problem-id">ID: 1</span>
                        <span id="problemDifficulty" class="difficulty-display difficulty-1">éš¾åº¦: 1</span>
                    </div>
                </div>

                <div id="problemContent">
                    <div class="problem-desc">
                        <p>ç»™å®šä¸¤ä¸ªæ•´æ•°Aå’ŒBï¼Œè¯·è®¡ç®—å®ƒä»¬çš„å’Œã€‚è¿™æ˜¯æœ€åŸºæœ¬çš„ç¼–ç¨‹å…¥é—¨é¢˜ç›®ã€‚</p>
                        <p style="color: #ff5252; font-weight: bold; margin-top: 10px;">
                            âš ï¸ å®‰å…¨æç¤ºï¼šç³»ç»Ÿæ£€æµ‹åˆ°å¼‚å¸¸è¡Œä¸ºå°†è‡ªåŠ¨é”å®šï¼Œæ‰€æœ‰æ“ä½œå°†è¢«è®°å½•å¹¶ä¸ŠæŠ¥æœåŠ¡å™¨ã€‚
                        </p>
                    </div>

                    <h3 class="section-title">è¾“å…¥æ ¼å¼</h3>
                    <div class="test-case-details" id="inputFormat">è¾“å…¥åŒ…å«ä¸¤ä¸ªæ•´æ•°Aå’ŒBï¼Œç”¨ç©ºæ ¼åˆ†éš”ã€‚</div>

                    <h3 class="section-title">è¾“å‡ºæ ¼å¼</h3>
                    <div class="test-case-details" id="outputFormat">è¾“å‡ºä¸€ä¸ªæ•´æ•°ï¼Œè¡¨ç¤ºA+Bçš„ç»“æœã€‚</div>

                    <h3 class="section-title">æ ·ä¾‹è¾“å…¥</h3>
                    <div class="test-case-details" id="sampleInput">1 2</div>

                    <h3 class="section-title">æ ·ä¾‹è¾“å‡º</h3>
                    <div class="test-case-details" id="sampleOutput">3</div>

                    <h3 class="section-title">çº¦æŸæ¡ä»¶</h3>
                    <div class="test-case-details" id="constraints">-1000 â‰¤ A, B â‰¤ 1000</div>

                    <h3 class="section-title">å®‰å…¨è¯´æ˜</h3>
                    <p>ç³»ç»Ÿé‡‡ç”¨å¤šå±‚å®‰å…¨é˜²æŠ¤ï¼š</p>
                    <ul>
                        <li>ä»£ç å®Œæ•´æ€§æ ¡éªŒ - é˜²æ­¢ä»£ç ç¯¡æ”¹</li>
                        <li>è¡Œä¸ºå¼‚å¸¸æ£€æµ‹ - ç›‘æ§åˆ‡å±å’Œå¼€å‘è€…å·¥å…·ä½¿ç”¨</li>
                        <li>ä»£ç æ··æ·†åŠ å¯† - å¢åŠ é€†å‘å·¥ç¨‹éš¾åº¦</li>
                        <li>æœåŠ¡å™¨ç«¯éªŒè¯ - æ‰€æœ‰æäº¤å‡åœ¨æœåŠ¡å™¨éªŒè¯</li>
                    </ul>
                    <p style="color: #ff5252; font-weight: bold;">æ£€æµ‹åˆ°å¼€å‘è€…å·¥å…·æˆ–ä»£ç ç¯¡æ”¹å°†è‡ªåŠ¨é”å®šç³»ç»Ÿå¹¶ä¸ŠæŠ¥è¿è§„è®°å½•ã€‚</p>
                </div>

                <div class="problem-list" id="problemList">
                    <h4>é¢˜ç›®åˆ—è¡¨</h4>
                    <!-- é¢˜ç›®åˆ—è¡¨å°†åœ¨è¿™é‡ŒåŠ¨æ€ç”Ÿæˆ -->
                </div>
            </div>

            <div class="code-section">
                <div class="code-header">
                    <h3>ä»£ç ç¼–è¾‘å™¨ (å—ä¿æŠ¤æ¨¡å¼)</h3>
                    <select class="language-selector" id="languageSelector">
                        <option value="c" selected>C</option>
                        <option value="cpp">C++</option>
                        <option value="java">Java</option>
                        <option value="python">Python</option>
                    </select>
                </div>
                <div class="code-editor">
                    <textarea id="codeEditor">#include <stdio.h>

int main() {
    int a, b;
    scanf("%d %d", &a, &b);
    printf("%d\n", a + b);
    return 0;
}</textarea>
                </div>
                <div class="actions-section">
                    <button class="btn btn-primary" id="runCode">è¿è¡Œä»£ç </button>
                    <button class="btn btn-secondary" id="resetCode">é‡ç½®ä»£ç </button>
                    <button class="btn btn-danger" id="clearCode">æ¸…ç©ºä»£ç </button>
                    <button class="btn btn-success" id="validateCode">æ ¡éªŒå®Œæ•´æ€§</button>
                </div>
            </div>
        </div>

        <footer>
            <p>Â© 2025-2026 åœ¨çº¿è¯„æµ‹ç³»ç»Ÿ - å®‰å…¨ç‰ˆæœ¬
            <a href="https://beian.miit.gov.cn/" target="_blank" style="color: var(--text-muted); text-decoration: none;">
                äº¬ICPå¤‡2025154249å·
            </a>
            </p>
            <p style="font-size: 0.8rem; margin-top: 5px;">å®‰å…¨å“ˆå¸Œ: <span id="securityHash">æ­£åœ¨è®¡ç®—...</span></p>
        </footer>
    </div>

    <!-- å®‰å…¨è­¦å‘Šå±å¹• -->
    <div class="security-warning" id="securityWarning">
        <div>
            <div style="font-size: 3rem; margin-bottom: 20px;">âš ï¸ å®‰å…¨è¿è§„æ£€æµ‹</div>
            <div style="font-size: 1.5rem; margin-bottom: 30px;">æ£€æµ‹åˆ°å¼€å‘è€…å·¥å…·æˆ–ä»£ç ç¯¡æ”¹è¡Œä¸º</div>
            <div style="font-size: 1.2rem; margin-bottom: 20px;">ç³»ç»Ÿå·²é”å®šï¼Œæ‰€æœ‰æ“ä½œå·²è¢«è®°å½•</div>
            <div style="font-size: 1rem; color: #aaa;">è¿è§„ID: <span id="violationId"></span></div>
        </div>
    </div>

    <!-- åŠ è½½é®ç½©å±‚ -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="loading-spinner"></div>
        <div style="color: white; margin-top: 20px; font-size: 1.2rem;">AIæ­£åœ¨ç”Ÿæˆé¢˜ç›®ï¼Œè¯·ç¨å€™...</div>
    </div>

    <!-- åˆ‡å±è­¦å‘Šæ¨¡æ€æ¡† -->
    <div class="modal" id="warningModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">âš ï¸ æ£€æµ‹åˆ°å¼‚å¸¸è¡Œä¸º</h2>
                <button class="close-modal" id="closeWarningModal">&times;</button>
            </div>
            <p>ç³»ç»Ÿæ£€æµ‹åˆ°æ‚¨åˆ‡æ¢äº†çª—å£æˆ–æ ‡ç­¾é¡µï¼Œæˆ–ä½¿ç”¨äº†å¼€å‘è€…å·¥å…·ã€‚</p>
            <p>å¼‚å¸¸è¡Œä¸ºæ¬¡æ•°: <span id="modalSwitchCount">0</span></p>
            <p>è¯·ä¸“æ³¨äºå½“å‰è¯„æµ‹ï¼Œé¿å…å†æ¬¡è§¦å‘å®‰å…¨æ£€æµ‹ã€‚</p>
            <p style="color: #ff5252; font-weight: bold;">æ³¨æ„ï¼šç»§ç»­è¿è§„å¯èƒ½å¯¼è‡´ç³»ç»Ÿé”å®šï¼</p>
            <div style="text-align: center; margin-top: 20px;">
                <button class="btn btn-primary" id="confirmWarning">ç¡®è®¤</button>
            </div>
        </div>
    </div>

    <!-- è¯„æµ‹ç»“æœæ¨¡æ€æ¡† -->
    <div class="modal" id="resultsModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">è¯„æµ‹ç»“æœ (æœåŠ¡å™¨éªŒè¯)</h2>
                <button class="close-modal" id="closeResultsModal">&times;</button>
            </div>
            <div id="testResults"></div>
            <div id="serverValidation" style="margin-top: 20px; padding: 15px; background-color: #f5f5f5; border-radius: 5px;">
                <h4>æœåŠ¡å™¨éªŒè¯çŠ¶æ€</h4>
                <p id="validationStatus">ç­‰å¾…æœåŠ¡å™¨éªŒè¯...</p>
            </div>
        </div>
    </div>

    <!-- æ·»åŠ é¢˜ç›®æ¨¡æ€æ¡† -->
    <div class="addProblemModal" id="addProblemModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">æ‰‹åŠ¨æ·»åŠ é¢˜ç›®</h2>
                <button class="close-modal" id="closeAddProblemModal">&times;</button>
            </div>
            <form id="problemForm">
                <div class="form-group">
                    <label for="problemName">é¢˜ç›®åç§°</label>
                    <input type="text" id="problemName" class="form-control" placeholder="ä¾‹å¦‚ï¼šA + B é—®é¢˜" required>
                </div>

                <div class="form-group">
                    <label for="problemDescription">é¢˜ç›®æè¿°</label>
                    <textarea id="problemDescription" class="form-control" placeholder="æè¿°é¢˜ç›®çš„è¦æ±‚å’ŒèƒŒæ™¯" required></textarea>
                </div>

                <div class="form-group">
                    <label for="problemInputFormat">è¾“å…¥æ ¼å¼</label>
                    <textarea id="problemInputFormat" class="form-control" placeholder="æè¿°è¾“å…¥æ•°æ®çš„æ ¼å¼" required></textarea>
                </div>

                <div class="form-group">
                    <label for="problemOutputFormat">è¾“å‡ºæ ¼å¼</label>
                    <textarea id="problemOutputFormat" class="form-control" placeholder="æè¿°è¾“å‡ºæ•°æ®çš„æ ¼å¼" required></textarea>
                </div>

                <div class="form-group">
                    <label for="problemSampleInput">æ ·ä¾‹è¾“å…¥</label>
                    <textarea id="problemSampleInput" class="form-control" placeholder="è¾“å…¥æ ·ä¾‹" required></textarea>
                </div>

                <div class="form-group">
                    <label for="problemSampleOutput">æ ·ä¾‹è¾“å‡º</label>
                    <textarea id="problemSampleOutput" class="form-control" placeholder="å¯¹åº”æ ·ä¾‹çš„è¾“å‡º" required></textarea>
                </div>

                <div class="form-group">
                    <label for="problemConstraints">çº¦æŸæ¡ä»¶</label>
                    <textarea id="problemConstraints" class="form-control" placeholder="æè¿°æ•°æ®èŒƒå›´å’Œé™åˆ¶æ¡ä»¶"></textarea>
                </div>

                <div class="form-group">
                    <label for="problemDifficultyManual">éš¾åº¦ (1-10)</label>
                    <input type="number" id="problemDifficultyManual" class="form-control" min="1" max="10" value="5" required>
                </div>

                <div class="form-group">
                    <label for="problemTestCases">æµ‹è¯•ç”¨ä¾‹ (JSONæ ¼å¼)</label>
                    <textarea id="problemTestCases" class="form-control" placeholder='[{"input": "1 2", "expected": "3", "name": "æ ·ä¾‹æµ‹è¯•"}]' rows="6"></textarea>
                    <small>æ¯ä¸ªæµ‹è¯•ç”¨ä¾‹åŒ…å«input(è¾“å…¥)ã€expected(æœŸæœ›è¾“å‡º)ã€name(æµ‹è¯•åç§°)</small>
                </div>

                <div style="text-align: center; margin-top: 20px;">
                    <button type="submit" class="btn btn-primary" style="padding: 12px 30px;">æ·»åŠ é¢˜ç›®</button>
                    <button type="button" class="btn btn-secondary" id="cancelAddProblem" style="margin-left: 10px;">å–æ¶ˆ</button>
                </div>
            </form>
        </div>
    </div>

    <!-- å¼•å…¥CodeMirroråº“ -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.5/codemirror.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.5/mode/clike/clike.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.5/mode/python/python.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.5/mode/clike/clike.min.js"></script>

    <script>
        // å®‰å…¨é…ç½®
        const SECURITY_CONFIG = {
            ENABLED: true,
            MAX_VIOLATIONS: 3,
            LOCK_TIMEOUT: 30000, // 30ç§’é”å®š
            SERVER_VALIDATION_URL: 'https://your-server.com/validate', // æœåŠ¡å™¨éªŒè¯åœ°å€
            CODE_INTEGRITY_CHECK: true,
            DETECT_DEVTOOLS: true,
            DETECT_TAMPERING: true,
            ENABLE_OBFUSCATION: true
        };

        // å®‰å…¨çŠ¶æ€
        let securityState = {
            violations: 0,
            isLocked: false,
            integrityHash: '',
            lastCodeHash: '',
            sessionId: generateSessionId(),
            violationLog: []
        };

        // ç”Ÿæˆä¼šè¯ID
        function generateSessionId() {
            return 'sess_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
        }

        // ç”Ÿæˆè¿è§„ID
        function generateViolationId() {
            return 'viol_' + Date.now() + '_' + Math.random().toString(36).substr(2, 6);
        }

        // è®¡ç®—ä»£ç å®Œæ•´æ€§å“ˆå¸Œ
        function calculateCodeIntegrity() {
            const code = codeEditor.getValue();
            const timestamp = Date.now();
            // ä½¿ç”¨ç®€å•å“ˆå¸Œç®—æ³•
            let hash = 0;
            for (let i = 0; i < code.length; i++) {
                hash = ((hash << 5) - hash) + code.charCodeAt(i);
                hash = hash & hash;
            }
            return (hash + timestamp).toString(36);
        }

        // æ ¡éªŒä»£ç å®Œæ•´æ€§
        function validateCodeIntegrity() {
            const currentHash = calculateCodeIntegrity();
            if (securityState.lastCodeHash && currentHash !== securityState.lastCodeHash) {
                recordViolation('ä»£ç å®Œæ•´æ€§æ ¡éªŒå¤±è´¥', 'CODE_TAMPERING');
                return false;
            }
            securityState.lastCodeHash = currentHash;
            return true;
        }

        // è®°å½•è¿è§„è¡Œä¸º
        function recordViolation(reason, type) {
            if (!SECURITY_CONFIG.ENABLED || securityState.isLocked) return;

            const violationId = generateViolationId();
            securityState.violations++;
            securityState.violationLog.push({
                id: violationId,
                timestamp: new Date().toISOString(),
                reason: reason,
                type: type,
                sessionId: securityState.sessionId
            });

            // æ›´æ–°UI
            document.getElementById('securityStatus').textContent = 'è¿è§„';
            document.getElementById('securityStatus').style.color = '#ff5252';
            document.getElementById('warningBadge').style.display = 'block';
            document.getElementById('warningBadge').textContent = 'å®‰å…¨è¿è§„ï¼';

            // æ˜¾ç¤ºè­¦å‘Š
            showSecurityWarning(violationId);

            // å¦‚æœè¿è§„æ¬¡æ•°è¶…è¿‡é˜ˆå€¼ï¼Œé”å®šç³»ç»Ÿ
            if (securityState.violations >= SECURITY_CONFIG.MAX_VIOLATIONS) {
                lockSystem();
            }

            // è®°å½•åˆ°æ§åˆ¶å°
            console.error(`[å®‰å…¨è¿è§„] ${reason} (${type}) - è¿è§„ID: ${violationId}`);

            // å®é™…åº”ç”¨ä¸­åº”å‘é€åˆ°æœåŠ¡å™¨
            // sendViolationToServer(violationId, reason, type);

            return violationId;
        }

        // æ˜¾ç¤ºå®‰å…¨è­¦å‘Š
        function showSecurityWarning(violationId) {
            document.getElementById('violationId').textContent = violationId;
            document.getElementById('securityWarning').classList.add('active');

            // 30ç§’åè‡ªåŠ¨éšè—ï¼ˆå¦‚æœä¸æ˜¯é”å®šçŠ¶æ€ï¼‰
            setTimeout(() => {
                if (!securityState.isLocked) {
                    document.getElementById('securityWarning').classList.remove('active');
                }
            }, 5000);
        }

        // é”å®šç³»ç»Ÿ
        function lockSystem() {
            securityState.isLocked = true;
            document.getElementById('securityWarning').classList.add('active');
            document.getElementById('securityStatus').textContent = 'å·²é”å®š';

            // ç¦ç”¨æ‰€æœ‰äº¤äº’å…ƒç´ 
            document.querySelectorAll('button, input, textarea, select').forEach(el => {
                el.disabled = true;
            });

            // æ˜¾ç¤ºé”å®šæ¶ˆæ¯
            document.getElementById('securityWarning').innerHTML = `
                <div>
                    <div style="font-size: 3rem; margin-bottom: 20px;">ğŸ”’ ç³»ç»Ÿå·²é”å®š</div>
                    <div style="font-size: 1.5rem; margin-bottom: 30px;">æ£€æµ‹åˆ°å¤šæ¬¡å®‰å…¨è¿è§„è¡Œä¸º</div>
                    <div style="font-size: 1.2rem; margin-bottom: 20px;">ç³»ç»Ÿå·²é”å®šï¼Œæ‰€æœ‰æ“ä½œå·²è¢«è®°å½•å¹¶ä¸ŠæŠ¥</div>
                    <div style="font-size: 1rem; color: #aaa;">è¿è§„ID: ${securityState.violationLog[securityState.violationLog.length-1]?.id || 'æœªçŸ¥'}</div>
                    <div style="font-size: 1rem; color: #aaa; margin-top: 10px;">ä¼šè¯ID: ${securityState.sessionId}</div>
                </div>
            `;

            // 30ç§’åè‡ªåŠ¨è§£é”ï¼ˆå®é™…åº”ç”¨ä¸­åº”ç”±ç®¡ç†å‘˜è§£é”ï¼‰
            setTimeout(() => {
                if (securityState.isLocked) {
                    securityState.isLocked = false;
                    securityState.violations = 0;
                    document.getElementById('securityWarning').classList.remove('active');
                    document.getElementById('securityStatus').textContent = 'å®‰å…¨';
                    document.getElementById('securityStatus').style.color = '#4caf50';

                    // é‡æ–°å¯ç”¨æ‰€æœ‰äº¤äº’å…ƒç´ 
                    document.querySelectorAll('button, input, textarea, select').forEach(el => {
                        el.disabled = false;
                    });
                }
            }, SECURITY_CONFIG.LOCK_TIMEOUT);
        }

        // å¼€å‘è€…å·¥å…·æ£€æµ‹
        function detectDevTools() {
            if (!SECURITY_CONFIG.DETECT_DEVTOOLS) return;

            // æ–¹æ³•1: æ£€æµ‹çª—å£å¤§å°å·®å¼‚
            const widthThreshold = window.outerWidth - window.innerWidth > 100;
            const heightThreshold = window.outerHeight - window.innerHeight > 100;

            if (widthThreshold || heightThreshold) {
                recordViolation('æ£€æµ‹åˆ°å¼€å‘è€…å·¥å…·çª—å£', 'DEVTOOLS_OPEN');
            }

            // æ–¹æ³•2: æ£€æµ‹debuggerè¯­å¥
            const startTime = Date.now();
            debugger; // å¦‚æœå¼€å‘è€…å·¥å…·æ‰“å¼€ï¼Œä¼šåœ¨è¿™é‡Œæš‚åœ
            const endTime = Date.now();

            if (endTime - startTime > 100) { // å¦‚æœæš‚åœæ—¶é—´è¶…è¿‡100ms
                recordViolation('æ£€æµ‹åˆ°è°ƒè¯•å™¨æ´»åŠ¨', 'DEBUGGER_DETECTED');
            }

            // æ–¹æ³•3: é‡å†™consoleæ–¹æ³•
            const originalConsole = {
                log: console.log,
                warn: console.warn,
                error: console.error
            };

            console.log = function() {
                recordViolation('æ§åˆ¶å°æ—¥å¿—è®¿é—®', 'CONSOLE_ACCESS');
                originalConsole.log.apply(console, arguments);
            };

            console.warn = function() {
                recordViolation('æ§åˆ¶å°è­¦å‘Šè®¿é—®', 'CONSOLE_ACCESS');
                originalConsole.warn.apply(console, arguments);
            };

            console.error = function() {
                // ä¸è®°å½•é”™è¯¯ï¼Œé¿å…å¾ªç¯
                originalConsole.error.apply(console, arguments);
            };
        }

        // ä»£ç ç¯¡æ”¹æ£€æµ‹
        function detectTampering() {
            if (!SECURITY_CONFIG.DETECT_TAMPERING) return;

            // æ£€æŸ¥å…³é”®å‡½æ•°æ˜¯å¦è¢«ä¿®æ”¹
            const criticalFunctions = [
                'evaluateCode',
                'validateCodeIntegrity',
                'recordViolation',
                'detectDevTools'
            ];

            criticalFunctions.forEach(funcName => {
                if (typeof window[funcName] !== 'function') {
                    recordViolation(`å…³é”®å‡½æ•° ${funcName} è¢«ä¿®æ”¹æˆ–åˆ é™¤`, 'CODE_TAMPERING`);
                }
            });

            // æ£€æŸ¥DOMæ˜¯å¦è¢«ä¿®æ”¹
            const originalHTML = document.documentElement.innerHTML.length;
            setInterval(() => {
                if (document.documentElement.innerHTML.length !== originalHTML) {
                    recordViolation('DOMç»“æ„è¢«ä¿®æ”¹', 'DOM_TAMPERING');
                }
            }, 1000);
        }

        // ä»£ç æ··æ·†ï¼ˆç®€å•ç¤ºä¾‹ï¼‰
        function obfuscateCode(code) {
            if (!SECURITY_CONFIG.ENABLE_OBFUSCATION) return code;

            // ç®€å•çš„å­—ç¬¦ä¸²æ··æ·†
            return code.split('').map(char => {
                return String.fromCharCode(char.charCodeAt(0) ^ 0x55);
            }).join('');
        }

        // åæ··æ·†
        function deobfuscateCode(code) {
            if (!SECURITY_CONFIG.ENABLE_OBFUSCATION) return code;

            return code.split('').map(char => {
                return String.fromCharCode(char.charCodeAt(0) ^ 0x55);
            }).join('');
        }

        // åˆå§‹åŒ–å®‰å…¨ç³»ç»Ÿ
        function initSecuritySystem() {
            console.log('[å®‰å…¨ç³»ç»Ÿ] åˆå§‹åŒ–...');

            // è®¡ç®—åˆå§‹å®Œæ•´æ€§å“ˆå¸Œ
            securityState.integrityHash = calculateCodeIntegrity();
            securityState.lastCodeHash = securityState.integrityHash;

            // æ›´æ–°å®‰å…¨å“ˆå¸Œæ˜¾ç¤º
            document.getElementById('securityHash').textContent =
                securityState.integrityHash.substring(0, 16) + '...';

            // å¯åŠ¨å®‰å…¨æ£€æµ‹
            if (SECURITY_CONFIG.ENABLED) {
                setInterval(detectDevTools, 2000);
                setInterval(detectTampering, 3000);
                setInterval(validateCodeIntegrity, 5000);

                // åˆå§‹æ£€æµ‹
                detectDevTools();
                detectTampering();
                validateCodeIntegrity();
            }

            console.log('[å®‰å…¨ç³»ç»Ÿ] åˆå§‹åŒ–å®Œæˆï¼Œä¼šè¯ID:', securityState.sessionId);
        }

        // ==================== ä¸»åº”ç”¨ç¨‹åºä»£ç  ====================
        // åˆå§‹åŒ–ä»£ç ç¼–è¾‘å™¨
        const codeEditor = CodeMirror.fromTextArea(document.getElementById('codeEditor'), {
            lineNumbers: true,
            mode: "text/x-csrc",
            theme: "monokai",
            indentUnit: 4,
            tabSize: 4,
            lineWrapping: true,
            autofocus: true
        });

        // é…ç½®AIé¢˜ç›®ç”Ÿæˆçš„APIå‚æ•°
        const AI_API_CONFIG = {
            BASE_URL: 'https://dashscope.aliyuncs.com/compatible-mode/v1',
            MODEL_NAME: 'qwen-plus',
            API_KEY: 'sk-7cc25be93a9540328aa4c104da6c4612'
        };

        // é¢˜ç›®æ•°æ®å­˜å‚¨
        let problems = [];
        let currentProblemId = 1;
        let aiGeneratedCount = 0;
        let lastAIGeneratedTopics = {};

        // æ˜¾ç¤ºåŠ è½½é®ç½©å±‚
        function showLoading() {
            document.getElementById('loadingOverlay').style.display = 'flex';
        }

        // éšè—åŠ è½½é®ç½©å±‚
        function hideLoading() {
            document.getElementById('loadingOverlay').style.display = 'none';
        }

        // æ˜¾ç¤ºé€šçŸ¥æ¶ˆæ¯
        function showNotification(message, type = 'info') {
            // åˆ›å»ºé€šçŸ¥å…ƒç´ 
            const notification = document.createElement('div');
            notification.className = `notification notification-${type}`;
            notification.textContent = message;
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                padding: 12px 20px;
                background: ${type === 'success' ? '#4CAF50' : type === 'error' ? '#f44336' : '#2196F3'};
                color: white;
                border-radius: 4px;
                z-index: 10000;
                box-shadow: 0 4px 12px rgba(0,0,0,0.15);
                animation: slideIn 0.3s ease;
            `;

            document.body.appendChild(notification);

            // 3ç§’åè‡ªåŠ¨ç§»é™¤
            setTimeout(() => {
                notification.style.animation = 'slideOut 0.3s ease';
                setTimeout(() => {
                    if (notification.parentNode) {
                        document.body.removeChild(notification);
                    }
                }, 300);
            }, 3000);

            // æ·»åŠ CSSåŠ¨ç”»
            if (!document.querySelector('#notification-styles')) {
                const style = document.createElement('style');
                style.id = 'notification-styles';
                style.textContent = `
                    @keyframes slideIn {
                        from { transform: translateX(100%); opacity: 0; }
                        to { transform: translateX(0); opacity: 1; }
                    }
                    @keyframes slideOut {
                        from { transform: translateX(0); opacity: 1; }
                        to { transform: translateX(100%); opacity: 0; }
                    }
                `;
                document.head.appendChild(style);
            }
        }

        // åˆå§‹åŒ–é—®é¢˜åˆ—è¡¨
        function initializeProblemList() {
            const problemListContainer = document.getElementById('problemList');
            problemListContainer.innerHTML = '<h4>é¢˜ç›®åˆ—è¡¨</h4>';

            if (problems.length === 0) {
                problemListContainer.innerHTML += '<p>æš‚æ— é¢˜ç›®ï¼Œè¯·ç‚¹å‡»"AIç”Ÿæˆé¢˜ç›®"æŒ‰é’®åˆ›å»ºé¢˜ç›®ã€‚</p>';
                return;
            }

            problems.forEach(problem => {
                const problemItem = document.createElement('div');
                problemItem.className = `problem-list-item ${problem.id === currentProblemId ? 'active' : ''} ${problem.aiGenerated ? 'ai-generated' : ''}`;
                problemItem.dataset.id = problem.id;

                const aiTag = problem.aiGenerated ? '<span class="ai-tag">AIç”Ÿæˆ</span>' : '';

                problemItem.innerHTML = `
                    <div class="problem-list-title">${problem.id}. ${problem.title} ${aiTag}</div>
                    <div class="problem-list-desc">${problem.description.substring(0, 50)}...</div>
                    <div style="font-size: 0.8rem; color: #888; margin-top: 5px;">éš¾åº¦: ${problem.difficulty || 1}/10</div>
                `;

                problemItem.addEventListener('click', () => {
                    // å®‰å…¨æ£€æŸ¥
                    if (!validateCodeIntegrity()) {
                        showNotification('ä»£ç å®Œæ•´æ€§æ ¡éªŒå¤±è´¥ï¼Œæ“ä½œè¢«é˜»æ­¢', 'error');
                        return;
                    }

                    document.querySelectorAll('.problem-list-item').forEach(item => {
                        item.classList.remove('active');
                    });
                    problemItem.classList.add('active');

                    loadProblem(problem.id);
                });

                problemListContainer.appendChild(problemItem);
            });
        }

        // åŠ è½½é¢˜ç›®
        function loadProblem(problemId) {
            const problem = problems.find(p => p.id == problemId);
            if (!problem) return;

            currentProblemId = problemId;

            // æ›´æ–°é¡µé¢æ˜¾ç¤º
            document.getElementById('problemTitle').textContent = `${problem.id}. ${problem.title}`;
            document.getElementById('inputFormat').textContent = problem.inputFormat;
            document.getElementById('outputFormat').textContent = problem.outputFormat;
            document.getElementById('sampleInput').textContent = problem.sampleInput;
            document.getElementById('sampleOutput').textContent = problem.sampleOutput;
            document.getElementById('constraints').innerHTML = problem.constraints;

            const problemDesc = document.querySelector('.problem-desc');
            problemDesc.innerHTML = `<p>${problem.description}</p>`;

            const difficultyElement = document.getElementById('problemDifficulty');
            difficultyElement.textContent = `éš¾åº¦: ${problem.difficulty || 1}`;
            difficultyElement.className = `difficulty-display difficulty-${Math.min(problem.difficulty || 1, 10)}`;

            document.querySelector('.problem-id').textContent = `ID: ${problem.id}`;

            // æ ¹æ®é¢˜ç›®ç±»å‹å’Œéš¾åº¦è®¾ç½®é»˜è®¤ä»£ç 
            let defaultCode = '';
            const language = document.getElementById('languageSelector').value;
            const difficulty = problem.difficulty || 1;

            if (language === 'c' || language === 'cpp') {
                if (difficulty <= 3) {
                    defaultCode = `#include <stdio.h>\n\nint main() {\n    // ç®€å•é¢˜ç›®ï¼Œè¯·åœ¨æ­¤ç¼–å†™ä»£ç \n    return 0;\n}`;
                } else if (difficulty <= 7) {
                    defaultCode = `#include <stdio.h>\n#include <stdlib.h>\n\nint main() {\n    // ä¸­ç­‰éš¾åº¦é¢˜ç›®ï¼Œå¯èƒ½éœ€è¦æ•°ç»„æˆ–å­—ç¬¦ä¸²å¤„ç†\n    return 0;\n}`;
                } else {
                    defaultCode = `#include <stdio.h>\n#include <stdlib.h>\n#include <string.h>\n\nint main() {\n    // é«˜éš¾åº¦é¢˜ç›®ï¼Œå¯èƒ½éœ€è¦å¤æ‚ç®—æ³•\n    return 0;\n}`;
                }
            } else if (language === 'python') {
                if (difficulty <= 3) {
                    defaultCode = `# ç®€å•é¢˜ç›®ï¼Œè¯·åœ¨æ­¤ç¼–å†™ä»£ç `;
                } else if (difficulty <= 7) {
                    defaultCode = `# ä¸­ç­‰éš¾åº¦é¢˜ç›®ï¼Œå¯èƒ½éœ€è¦åˆ—è¡¨æˆ–å­—å…¸å¤„ç†`;
                } else {
                    defaultCode = `# é«˜éš¾åº¦é¢˜ç›®ï¼Œå¯èƒ½éœ€è¦å¤æ‚ç®—æ³•`;
                }
            } else if (language === 'java') {
                defaultCode = `public class Main {\n    public static void main(String[] args) {\n        // è¯·åœ¨æ­¤ç¼–å†™ä»£ç \n    }\n}`;
            }

            codeEditor.setValue(defaultCode);
            document.getElementById('resultsModal').style.display = 'none';

            // æ›´æ–°ä»£ç å®Œæ•´æ€§å“ˆå¸Œ
            securityState.lastCodeHash = calculateCodeIntegrity();
        }

        // æ ¹æ®éš¾åº¦å€¼ç”Ÿæˆå¯¹åº”çš„æç¤ºè¯
        function getPromptByDifficulty(difficulty) {
            const difficultyDescriptions = [
                "éå¸¸ç®€å•ï¼Œé€‚åˆç¼–ç¨‹åˆå­¦è€…ï¼Œæ¶‰åŠåŸºæœ¬è¾“å…¥è¾“å‡ºå’Œç®€å•è®¡ç®—",
                "ç®€å•ï¼Œæ¶‰åŠåŸºç¡€æ¡ä»¶åˆ¤æ–­å’Œå¾ªç¯",
                "ä¸­ç­‰åæ˜“ï¼Œæ¶‰åŠæ•°ç»„æˆ–å­—ç¬¦ä¸²çš„åŸºæœ¬æ“ä½œ",
                "ä¸­ç­‰ï¼Œæ¶‰åŠç®€å•çš„ç®—æ³•å¦‚æ’åºæˆ–æŸ¥æ‰¾",
                "ä¸­ç­‰åéš¾ï¼Œæ¶‰åŠå¸¸è§çš„ç®—æ³•é—®é¢˜å¦‚åŠ¨æ€è§„åˆ’æˆ–å›¾è®ºåŸºç¡€",
                "è¾ƒéš¾ï¼Œéœ€è¦ä¸€å®šçš„ç®—æ³•çŸ¥è¯†å’Œä¼˜åŒ–èƒ½åŠ›",
                "å›°éš¾ï¼Œæ¶‰åŠå¤æ‚ç®—æ³•æˆ–æ•°æ®ç»“æ„",
                "éå¸¸å›°éš¾ï¼Œéœ€è¦é«˜çº§ç®—æ³•çŸ¥è¯†å’Œä¼˜åŒ–æŠ€å·§",
                "æéš¾ï¼ŒæŒ‘æˆ˜æ€§å¾ˆé«˜ï¼Œéœ€è¦æ·±å…¥ç†è§£ç®—æ³•åŸç†",
                "æé™éš¾åº¦ï¼Œé€‚åˆç®—æ³•ç«èµ›é«˜æ‰‹"
            ];

            const topicsByDifficulty = [
                ["A+Bé—®é¢˜", "è®¡ç®—ä¸¤ä¸ªæ•°çš„ä¹˜ç§¯", "åˆ¤æ–­å¥‡å¶æ•°", "æ±‚ç»å¯¹å€¼", "è®¡ç®—ä¸¤ä¸ªæ•°çš„å·®"],
                ["è®¡ç®—é˜¶ä¹˜", "æ–æ³¢é‚£å¥‘æ•°åˆ—", "ç´ æ•°åˆ¤æ–­", "æ±‚æœ€å¤§å…¬çº¦æ•°", "æ±‚æœ€å°å…¬å€æ•°"],
                ["æ•°ç»„æ±‚å’Œ", "å­—ç¬¦ä¸²åè½¬", "æŸ¥æ‰¾æœ€å¤§æœ€å°å€¼", "çŸ©é˜µè½¬ç½®", "ç»Ÿè®¡å­—ç¬¦å‡ºç°æ¬¡æ•°"],
                ["å†’æ³¡æ’åº", "äºŒåˆ†æŸ¥æ‰¾", "é€‰æ‹©æ’åº", "æ’å…¥æ’åº", "çº¿æ€§æœç´¢"],
                ["01èƒŒåŒ…é—®é¢˜", "æœ€é•¿å…¬å…±å­åºåˆ—", "æœ€çŸ­è·¯å¾„é—®é¢˜", "äºŒå‰æ ‘éå†", "å›¾çš„æ·±åº¦ä¼˜å…ˆæœç´¢"],
                ["å¤æ‚åŠ¨æ€è§„åˆ’", "å›¾è®ºç®—æ³•", "é«˜çº§æ•°æ®ç»“æ„", "å¤æ‚å­—ç¬¦ä¸²å¤„ç†", "è®¡ç®—å‡ ä½•åŸºç¡€"],
                ["ç½‘ç»œæµé—®é¢˜", "é«˜çº§å›¾è®º", "è®¡ç®—å‡ ä½•", "æ•°è®ºéš¾é¢˜", "å­—ç¬¦ä¸²é«˜çº§ç®—æ³•"],
                ["NPéš¾é—®é¢˜è¿‘ä¼¼ç®—æ³•", "é«˜çº§åŠ¨æ€è§„åˆ’ä¼˜åŒ–", "å¤æ‚ç»„åˆæ•°å­¦", "é«˜çº§è®¡ç®—å‡ ä½•", "æ•°è®ºé«˜çº§é—®é¢˜"],
                ["ç«èµ›çº§éš¾é¢˜", "éœ€è¦å¤æ‚æ¨å¯¼çš„é—®é¢˜", "å¤šç»´åº¦ä¼˜åŒ–é—®é¢˜", "é«˜çº§ç®—æ³•ç»¼åˆ", "å¤æ‚æ•°å­¦é—®é¢˜"],
                ["é¡¶çº§ç®—æ³•ç«èµ›éš¾é¢˜", "éœ€è¦åˆ›æ–°æ€§è§£æ³•çš„é—®é¢˜", "ç»¼åˆæ€§æé«˜çš„é—®é¢˜", "å›½é™…ç«èµ›å‹è½´é¢˜", "ç ”ç©¶çº§ç®—æ³•é—®é¢˜"]
            ];

            const index = Math.min(Math.max(Math.floor(difficulty) - 1, 0), 9);
            const availableTopics = topicsByDifficulty[index];
            const lastTopics = lastAIGeneratedTopics[difficulty] || [];

            let candidates = availableTopics.filter(topic => !lastTopics.includes(topic));

            if (candidates.length === 0) {
                candidates = availableTopics;
                lastAIGeneratedTopics[difficulty] = [];
            }

            const randomTopic = candidates[Math.floor(Math.random() * candidates.length)];

            if (!lastAIGeneratedTopics[difficulty]) {
                lastAIGeneratedTopics[difficulty] = [];
            }
            lastAIGeneratedTopics[difficulty].push(randomTopic);

            if (lastAIGeneratedTopics[difficulty].length > 5) {
                lastAIGeneratedTopics[difficulty].shift();
            }

            return {
                description: difficultyDescriptions[index],
                topic: randomTopic,
                level: index + 1
            };
        }

        // AIç”Ÿæˆé¢˜ç›®å‡½æ•°
        async function generateAIProblem() {
            // å®‰å…¨æ£€æŸ¥
            if (!validateCodeIntegrity()) {
                showNotification('ä»£ç å®Œæ•´æ€§æ ¡éªŒå¤±è´¥ï¼Œæ“ä½œè¢«é˜»æ­¢', 'error');
                return;
            }

            const difficultyInput = document.getElementById('difficultyInput');
            let difficulty = parseInt(difficultyInput.value);

            if (isNaN(difficulty) || difficulty < 1 || difficulty > 10) {
                showNotification('éš¾åº¦å€¼å¿…é¡»åœ¨1-10ä¹‹é—´', 'error');
                difficultyInput.value = 5;
                difficulty = 5;
            }

            const promptInfo = getPromptByDifficulty(difficulty);

            showLoading();

            const systemPrompt = `ä½ æ˜¯ä¸€ä¸ªåœ¨çº¿ç¼–ç¨‹è¯„æµ‹ç³»ç»Ÿï¼ˆOnline Judgeï¼‰çš„å‡ºé¢˜ä¸“å®¶ã€‚
è¯·ç”Ÿæˆä¸€é“é€‚åˆç¼–ç¨‹å­¦ä¹ è€…çš„ç¼–ç¨‹é¢˜ç›®ï¼Œè¦æ±‚å¦‚ä¸‹ï¼š
1. **é¢˜ç›®åç§°**ï¼šä¸€ä¸ªç®€æ´æ˜ç¡®çš„æ ‡é¢˜ï¼Œåæ˜ é¢˜ç›®æ ¸å¿ƒå†…å®¹
2. **é¢˜ç›®æè¿°**ï¼šæ¸…æ™°åœ°æè¿°é—®é¢˜èƒŒæ™¯ã€è¦æ±‚å’Œè¾“å…¥è¾“å‡ºè¯´æ˜
3. **è¾“å…¥æ ¼å¼**ï¼šè¯¦ç»†è¯´æ˜è¾“å…¥æ•°æ®çš„æ ¼å¼ã€ç±»å‹å’Œçº¦æŸ
4. **è¾“å‡ºæ ¼å¼**ï¼šè¯¦ç»†è¯´æ˜è¾“å‡ºæ•°æ®çš„æ ¼å¼å’Œè¦æ±‚
5. **æ ·ä¾‹è¾“å…¥**ï¼šæä¾›ä¸€ç»„å…¸å‹çš„è¾“å…¥æ ·ä¾‹
6. **æ ·ä¾‹è¾“å‡º**ï¼šæä¾›å¯¹åº”çš„è¾“å‡ºæ ·ä¾‹
7. **çº¦æŸæ¡ä»¶**ï¼šè¯´æ˜æ•°æ®èŒƒå›´ã€æ—¶é—´ç©ºé—´é™åˆ¶ç­‰

é¢˜ç›®éš¾åº¦çº§åˆ«ï¼š${difficulty}/10 (${promptInfo.description})
é¢˜ç›®ä¸»é¢˜ï¼š${promptInfo.topic}

**è¯·ä¸¥æ ¼ä½¿ç”¨ä»¥ä¸‹JSONæ ¼å¼è¿”å›ï¼Œä¸è¦åŒ…å«ä»»ä½•é¢å¤–çš„è§£é‡Šæˆ–Markdownæ ¼å¼ï¼š**
{
    "title": "é¢˜ç›®åç§°",
    "description": "é¢˜ç›®æè¿°",
    "inputFormat": "è¾“å…¥æ ¼å¼",
    "outputFormat": "è¾“å‡ºæ ¼å¼",
    "sampleInput": "æ ·ä¾‹è¾“å…¥",
    "sampleOutput": "æ ·ä¾‹è¾“å‡º",
    "constraints": "çº¦æŸæ¡ä»¶"
}`;

            const requestBody = {
                model: AI_API_CONFIG.MODEL_NAME,
                messages: [
                    { role: 'system', content: systemPrompt },
                    { role: 'user', content: `è¯·ç”Ÿæˆä¸€é“éš¾åº¦ä¸º${difficulty}/10çš„ç¼–ç¨‹é¢˜ç›®ï¼Œä¸»é¢˜ä¸${promptInfo.topic}ç›¸å…³ã€‚` }
                ],
                temperature: 1.0,
                max_tokens: 2000
            };

            try {
                const response = await fetch(`${AI_API_CONFIG.BASE_URL}/chat/completions`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${AI_API_CONFIG.API_KEY}`
                    },
                    body: JSON.stringify(requestBody)
                });

                if (!response.ok) {
                    throw new Error(`APIè¯·æ±‚å¤±è´¥: ${response.status}`);
                }

                const data = await response.json();
                let aiResponse = data.choices?.[0]?.message?.content || '';

                let problemData;

                try {
                    const jsonMatch = aiResponse.match(/```json\n([\s\S]*?)\n```/) || aiResponse.match(/```([\s\S]*?)```/);
                    if (jsonMatch) {
                        problemData = JSON.parse(jsonMatch[1]);
                    } else {
                        problemData = JSON.parse(aiResponse);
                    }
                } catch (parseError) {
                    console.error('è§£æAIå“åº”å¤±è´¥:', parseError);
                    problemData = {
                        title: `${promptInfo.topic} (éš¾åº¦${difficulty}/10)`,
                        description: `è¿™æ˜¯ä¸€é“éš¾åº¦ä¸º${difficulty}/10çš„ç¼–ç¨‹é¢˜ç›®ï¼Œæ¶‰åŠ${promptInfo.topic}ã€‚è¯·å®Œæˆé¢˜ç›®è¦æ±‚ã€‚`,
                        inputFormat: "æ ‡å‡†è¾“å…¥ï¼Œå…·ä½“æ ¼å¼è§é¢˜ç›®æè¿°",
                        outputFormat: "æ ‡å‡†è¾“å‡ºï¼Œå…·ä½“æ ¼å¼è§é¢˜ç›®æè¿°",
                        sampleInput: "ç¤ºä¾‹è¾“å…¥",
                        sampleOutput: "ç¤ºä¾‹è¾“å‡º",
                        constraints: "æ•°æ®èŒƒå›´ï¼šæ ¹æ®å…·ä½“é¢˜ç›®è€Œå®š"
                    };
                }

                aiGeneratedCount++;
                const newProblemId = problems.length > 0 ? Math.max(...problems.map(p => p.id)) + 1 : 1000 + aiGeneratedCount;
                const newProblem = {
                    id: newProblemId,
                    title: problemData.title || `${promptInfo.topic} (AIç”Ÿæˆ)`,
                    description: problemData.description || "AIç”Ÿæˆçš„ç¼–ç¨‹é¢˜ç›®",
                    inputFormat: problemData.inputFormat || "ä»æ ‡å‡†è¾“å…¥è¯»å–æ•°æ®",
                    outputFormat: problemData.outputFormat || "è¾“å‡ºåˆ°æ ‡å‡†è¾“å‡º",
                    sampleInput: problemData.sampleInput || "ç¤ºä¾‹è¾“å…¥",
                    sampleOutput: problemData.sampleOutput || "ç¤ºä¾‹è¾“å‡º",
                    constraints: problemData.constraints || "å¸¸è§„çº¦æŸæ¡ä»¶",
                    difficulty: difficulty,
                    aiGenerated: true,
                    testCases: generateTestCasesFromAIProblem(problemData, difficulty, promptInfo.topic)
                };

                problems.push(newProblem);
                initializeProblemList();
                loadProblem(newProblemId);

                showNotification(`å·²æˆåŠŸç”Ÿæˆéš¾åº¦${difficulty}/10çš„æ–°é¢˜ç›®: ${newProblem.title}`, 'success');

            } catch (error) {
                console.error('ç”ŸæˆAIé¢˜ç›®å¤±è´¥:', error);
                showNotification(`ç”Ÿæˆé¢˜ç›®å¤±è´¥: ${error.message}`, 'error');
                loadDefaultFallbackProblem(difficulty);
            } finally {
                hideLoading();
            }
        }

        // ç”Ÿæˆæµ‹è¯•ç”¨ä¾‹
        function generateTestCasesFromAIProblem(problemData, difficulty, topic) {
            const testCases = [
                { input: problemData.sampleInput, expected: problemData.sampleOutput, name: "æ ·ä¾‹æµ‹è¯•" }
            ];

            if (difficulty <= 3) {
                testCases.push(
                    { input: "0 0", expected: "0", name: "è¾¹ç•Œæµ‹è¯•1" },
                    { input: "10 20", expected: "30", name: "åŸºç¡€æµ‹è¯•" },
                    { input: "-5 5", expected: "0", name: "æ­£è´Ÿæµ‹è¯•" },
                    { input: "100 -50", expected: "50", name: "è¾ƒå¤§æ•°å€¼æµ‹è¯•" }
                );
            } else if (difficulty <= 6) {
                testCases.push(
                    { input: "5 8", expected: "13", name: "åŸºç¡€æµ‹è¯•" },
                    { input: "-3 7", expected: "4", name: "åŒ…å«è´Ÿæ•°" },
                    { input: "100 200", expected: "300", name: "è¾ƒå¤§æ•°å€¼" },
                    { input: "0 100", expected: "100", name: "é›¶å€¼æµ‹è¯•" },
                    { input: "-10 -20", expected: "-30", name: "åŒè´Ÿæ•°æµ‹è¯•" }
                );
            } else {
                testCases.push(
                    { input: "15 25", expected: "40", name: "åŸºç¡€æµ‹è¯•" },
                    { input: "-10 5", expected: "-5", name: "è´Ÿæ•°æµ‹è¯•" },
                    { input: "999 1", expected: "1000", name: "è¾¹ç•Œæµ‹è¯•" },
                    { input: "123 456", expected: "579", name: "éšæœºæµ‹è¯•" },
                    { input: "-999 -1", expected: "-1000", name: "è´Ÿè¾¹ç•Œæµ‹è¯•" },
                    { input: "1000 1000", expected: "2000", name: "å¤§æ•°æµ‹è¯•" }
                );
            }

            return testCases;
        }

        // åŠ è½½é»˜è®¤åå¤‡é¢˜ç›®
        function loadDefaultFallbackProblem(difficulty = 5) {
            aiGeneratedCount++;
            const newProblemId = problems.length > 0 ? Math.max(...problems.map(p => p.id)) + 1 : 1000 + aiGeneratedCount;

            let defaultProblem;

            if (difficulty <= 3) {
                defaultProblem = {
                    id: newProblemId,
                    title: `ä¸¤æ•°ä¹‹å’Œ (éš¾åº¦${difficulty}/10)`,
                    description: `ç»™å®šä¸¤ä¸ªæ•´æ•°Aå’ŒBï¼Œè¯·è®¡ç®—å®ƒä»¬çš„å’Œã€‚`,
                    inputFormat: "è¾“å…¥åŒ…å«ä¸¤ä¸ªæ•´æ•°Aå’ŒBï¼Œç”¨ç©ºæ ¼åˆ†éš”ã€‚",
                    outputFormat: "è¾“å‡ºä¸€ä¸ªæ•´æ•°ï¼Œè¡¨ç¤ºA+Bçš„ç»“æœã€‚",
                    sampleInput: "1 2",
                    sampleOutput: "3",
                    constraints: "-1000 â‰¤ A, B â‰¤ 1000",
                    difficulty: difficulty,
                    aiGenerated: true,
                    testCases: [
                        { input: "1 2", expected: "3", name: "æ ·ä¾‹æµ‹è¯•" },
                        { input: "0 0", expected: "0", name: "é›¶æµ‹è¯•" },
                        { input: "-5 10", expected: "5", name: "è´Ÿæ•°æµ‹è¯•" },
                        { input: "100 200", expected: "300", name: "è¾ƒå¤§æ•°å€¼" }
                    ]
                };
            } else if (difficulty <= 6) {
                defaultProblem = {
                    id: newProblemId,
                    title: `æ–æ³¢é‚£å¥‘æ•°åˆ— (éš¾åº¦${difficulty}/10)`,
                    description: `ç»™å®šä¸€ä¸ªæ­£æ•´æ•°nï¼Œè¾“å‡ºæ–æ³¢é‚£å¥‘æ•°åˆ—çš„ç¬¬né¡¹ã€‚æ–æ³¢é‚£å¥‘æ•°åˆ—å®šä¹‰ä¸ºï¼šF(0)=0, F(1)=1, F(n)=F(n-1)+F(n-2) (nâ‰¥2)ã€‚`,
                    inputFormat: "è¾“å…¥ä¸€ä¸ªæ•´æ•°n (0 â‰¤ n â‰¤ 30)ã€‚",
                    outputFormat: "è¾“å‡ºæ–æ³¢é‚£å¥‘æ•°åˆ—çš„ç¬¬né¡¹ã€‚",
                    sampleInput: "5",
                    sampleOutput: "5",
                    constraints: "0 â‰¤ n â‰¤ 30",
                    difficulty: difficulty,
                    aiGenerated: true,
                    testCases: [
                        { input: "0", expected: "0", name: "æ ·ä¾‹æµ‹è¯•" },
                        { input: "1", expected: "1", name: "åŸºç¡€æµ‹è¯•" },
                        { input: "5", expected: "5", name: "ä¸­ç­‰æµ‹è¯•" },
                        { input: "10", expected: "55", name: "è¾ƒå¤§æ•°å€¼" },
                        { input: "20", expected: "6765", name: "è¾¹ç•Œæµ‹è¯•" }
                    ]
                };
            } else {
                defaultProblem = {
                    id: newProblemId,
                    title: `æœ€å¤§å­åºåˆ—å’Œ (éš¾åº¦${difficulty}/10)`,
                    description: `ç»™å®šä¸€ä¸ªæ•´æ•°åºåˆ—ï¼Œæ‰¾å‡ºå…¶ä¸­è¿ç»­å­åºåˆ—çš„æœ€å¤§å’Œã€‚`,
                    inputFormat: "ç¬¬ä¸€è¡Œè¾“å…¥æ•´æ•°n (1 â‰¤ n â‰¤ 1000)ï¼Œè¡¨ç¤ºåºåˆ—é•¿åº¦ã€‚ç¬¬äºŒè¡Œè¾“å…¥nä¸ªæ•´æ•°ï¼Œç”¨ç©ºæ ¼åˆ†éš”ã€‚",
                    outputFormat: "è¾“å‡ºä¸€ä¸ªæ•´æ•°ï¼Œè¡¨ç¤ºæœ€å¤§å­åºåˆ—å’Œã€‚",
                    sampleInput: "5\n1 -2 3 4 -5",
                    sampleOutput: "7",
                    constraints: "1 â‰¤ n â‰¤ 1000ï¼Œæ¯ä¸ªæ•´æ•°åœ¨-1000åˆ°1000ä¹‹é—´",
                    difficulty: difficulty,
                    aiGenerated: true,
                    testCases: [
                        { input: "5\n1 -2 3 4 -5", expected: "7", name: "æ ·ä¾‹æµ‹è¯•" },
                        { input: "3\n-1 -2 -3", expected: "-1", name: "å…¨è´Ÿæ•°æµ‹è¯•" },
                        { input: "4\n1 2 3 4", expected: "10", name: "å…¨æ­£æ•°æµ‹è¯•" },
                        { input: "6\n-2 11 -4 13 -5 -2", expected: "20", name: "å¤æ‚æµ‹è¯•" }
                    ]
                };
            }

            problems.push(defaultProblem);
            initializeProblemList();
            loadProblem(newProblemId);

            showNotification(`å·²ä½¿ç”¨å¤‡ç”¨é¢˜ç›®: ${defaultProblem.title}`, 'info');
        }

        // åˆ‡æ¢ç¼–ç¨‹è¯­è¨€
        document.getElementById('languageSelector').addEventListener('change', function() {
            if (!validateCodeIntegrity()) {
                showNotification('ä»£ç å®Œæ•´æ€§æ ¡éªŒå¤±è´¥ï¼Œæ“ä½œè¢«é˜»æ­¢', 'error');
                return;
            }

            const lang = this.value;
            let mode = "text/x-csrc";

            if (lang === "cpp") mode = "text/x-c++src";
            else if (lang === "java") mode = "text/x-java";
            else if (lang === "python") mode = "text/x-python";

            codeEditor.setOption("mode", mode);

            if (currentProblemId) {
                const problem = problems.find(p => p.id == currentProblemId);
                if (problem) {
                    const difficulty = problem.difficulty || 1;
                    let defaultCode = '';

                    if (lang === 'c' || lang === 'cpp') {
                        if (difficulty <= 3) {
                            defaultCode = `#include <stdio.h>\n\nint main() {\n    // ç®€å•é¢˜ç›®ï¼Œè¯·åœ¨æ­¤ç¼–å†™ä»£ç \n    return 0;\n}`;
                        } else if (difficulty <= 7) {
                            defaultCode = `#include <stdio.h>\n#include <stdlib.h>\n\nint main() {\n    // ä¸­ç­‰éš¾åº¦é¢˜ç›®ï¼Œå¯èƒ½éœ€è¦æ•°ç»„æˆ–å­—ç¬¦ä¸²å¤„ç†\n    return 0;\n}`;
                        } else {
                            defaultCode = `#include <stdio.h>\n#include <stdlib.h>\n#include <string.h>\n\nint main() {\n    // é«˜éš¾åº¦é¢˜ç›®ï¼Œå¯èƒ½éœ€è¦å¤æ‚ç®—æ³•\n    return 0;\n}`;
                        }
                    } else if (lang === 'python') {
                        if (difficulty <= 3) {
                            defaultCode = `# ç®€å•é¢˜ç›®ï¼Œè¯·åœ¨æ­¤ç¼–å†™ä»£ç `;
                        } else if (difficulty <= 7) {
                            defaultCode = `# ä¸­ç­‰éš¾åº¦é¢˜ç›®ï¼Œå¯èƒ½éœ€è¦åˆ—è¡¨æˆ–å­—å…¸å¤„ç†`;
                        } else {
                            defaultCode = `# é«˜éš¾åº¦é¢˜ç›®ï¼Œå¯èƒ½éœ€è¦å¤æ‚ç®—æ³•`;
                        }
                    } else if (lang === 'java') {
                        defaultCode = `public class Main {\n    public static void main(String[] args) {\n        // è¯·åœ¨æ­¤ç¼–å†™ä»£ç \n    }\n}`;
                    }

                    codeEditor.setValue(defaultCode);
                }
            }
        });

        // åˆ‡å±æ£€æµ‹ç±»ï¼ˆå¢å¼ºç‰ˆï¼‰
        class ScreenSwitchDetector {
            constructor() {
                this.switchCount = 0;
                this.maxSwitches = 5;
                this.isDetecting = true;
                this.lastSwitchTime = 0;
                this.minSwitchInterval = 1000;
                this.init();
            }

            init() {
                document.addEventListener('visibilitychange', this.handleVisibilityChange.bind(this));
                window.addEventListener('blur', this.handleWindowBlur.bind(this));
                window.addEventListener('focus', this.handleWindowFocus.bind(this));
                this.preventDevTools();
                this.updateUI();
            }

            handleVisibilityChange() {
                if (document.hidden) {
                    this.recordSwitch('visibility');
                } else {
                    document.getElementById('pageStatus').textContent = 'æ´»è·ƒ';
                }
            }

            handleWindowBlur() {
                if (document.activeElement.tagName === 'BODY' ||
                    document.activeElement.tagName === 'HTML') {
                    this.recordSwitch('focus');
                }
            }

            handleWindowFocus() {
                document.getElementById('pageStatus').textContent = 'æ´»è·ƒ';
                document.getElementById('warningBadge').style.display = 'none';
            }

            recordSwitch(source) {
                const now = Date.now();

                if (now - this.lastSwitchTime < this.minSwitchInterval) {
                    return;
                }

                this.lastSwitchTime = now;
                this.switchCount++;

                this.updateUI();
                this.showWarning();

                if (this.switchCount >= this.maxSwitches) {
                    this.showSevereWarning();
                }

                console.log(`åˆ‡å±æ£€æµ‹ (${source}) - æ¬¡æ•°: ${this.switchCount}`);

                // è®°å½•å®‰å…¨è¿è§„
                recordViolation(`æ£€æµ‹åˆ°åˆ‡å±è¡Œä¸º (${source})`, 'SCREEN_SWITCH');
            }

            updateUI() {
                document.getElementById('switchCount').textContent = this.switchCount;
                document.getElementById('modalSwitchCount').textContent = this.switchCount;
            }

            showWarning() {
                const warningBadge = document.getElementById('warningBadge');
                warningBadge.style.display = 'block';

                setTimeout(() => {
                    warningBadge.style.display = 'none';
                }, 5000);

                if (this.switchCount >= 2) {
                    this.showModalWarning();
                }
            }

            showModalWarning() {
                const modal = document.getElementById('warningModal');
                modal.style.display = 'flex';
            }

            showSevereWarning() {
                alert(`ä¸¥é‡è­¦å‘Šï¼šæ‚¨å·²åˆ‡å±${this.switchCount}æ¬¡ï¼ç»§ç»­åˆ‡å±å¯èƒ½å¯¼è‡´è¯„æµ‹æ— æ•ˆã€‚`);
            }

            preventDevTools() {
                // é˜²æ­¢F12ç­‰å¿«æ·é”®
                document.addEventListener('keydown', e => {
                    if (e.key === 'F12' ||
                        (e.ctrlKey && e.shiftKey && e.key === 'I') ||
                        (e.ctrlKey && e.shiftKey && e.key === 'J') ||
                        (e.ctrlKey && e.key === 'U')) {
                        e.preventDefault();
                        this.recordSwitch('devtools');
                        recordViolation('å°è¯•æ‰“å¼€å¼€å‘è€…å·¥å…·', 'DEVTOOLS_ATTEMPT');
                        alert('å¼€å‘è€…å·¥å…·å·²è¢«ç¦ç”¨ï¼');
                    }
                });

                // é˜²æ­¢å³é”®èœå•
                document.addEventListener('contextmenu', e => {
                    e.preventDefault();
                    recordViolation('å°è¯•æ‰“å¼€å³é”®èœå•', 'CONTEXT_MENU_ATTEMPT');
                }, false);
            }

            resetCount() {
                this.switchCount = 0;
                this.updateUI();
            }

            getSwitchCount() {
                return this.switchCount;
            }
        }

        // åˆå§‹åŒ–åˆ‡å±æ£€æµ‹å™¨
        const screenDetector = new ScreenSwitchDetector();

        // å…³é—­è­¦å‘Šæ¨¡æ€æ¡†
        document.getElementById('closeWarningModal').addEventListener('click', function() {
            document.getElementById('warningModal').style.display = 'none';
        });

        document.getElementById('confirmWarning').addEventListener('click', function() {
            document.getElementById('warningModal').style.display = 'none';
        });

        // å…³é—­ç»“æœæ¨¡æ€æ¡†
        document.getElementById('closeResultsModal').addEventListener('click', function() {
            document.getElementById('resultsModal').style.display = 'none';
        });

        // æ¨¡æ‹Ÿè¯„æµ‹å‡½æ•°
        function evaluateCode(code, language, problemId) {
            // å®‰å…¨æ£€æŸ¥
            if (!validateCodeIntegrity()) {
                return {
                    results: [],
                    allPassed: false,
                    executionTime: 0,
                    switchCount: screenDetector.getSwitchCount(),
                    totalTests: 0,
                    passedTests: 0,
                    securityViolation: true
                };
            }

            const problem = problems.find(p => p.id == problemId);
            const testCases = problem ? problem.testCases : [];

            const results = [];
            let allPassed = true;
            let actualTests = 0;
            let passedTests = 0;

            testCases.forEach((testCase, index) => {
                let output = "";
                let passed = false;
                let isSampleTest = testCase.name === "æ ·ä¾‹æµ‹è¯•";

                try {
                    if (problem.title.includes("A+B") || problem.title.includes("ä¸¤æ•°ä¹‹å’Œ")) {
                        const [a, b] = testCase.input.split(' ').map(Number);
                        const result = a + b;
                        output = String(result);
                        passed = output === testCase.expected;
                    } else if (problem.title.includes("æ–æ³¢é‚£å¥‘")) {
                        const n = parseInt(testCase.input);
                        let fib;
                        if (n === 0) fib = 0;
                        else if (n === 1) fib = 1;
                        else {
                            let a = 0, b = 1;
                            for (let i = 2; i <= n; i++) {
                                fib = a + b;
                                a = b;
                                b = fib;
                            }
                        }
                        output = String(fib);
                        passed = output === testCase.expected;
                    } else if (problem.title.includes("æœ€å¤§å­åºåˆ—")) {
                        const lines = testCase.input.split('\n');
                        const n = parseInt(lines[0]);
                        const nums = lines[1].split(' ').map(Number);
                        let maxSum = nums[0];
                        let currentSum = nums[0];

                        for (let i = 1; i < n; i++) {
                            currentSum = Math.max(nums[i], currentSum + nums[i]);
                            maxSum = Math.max(maxSum, currentSum);
                        }

                        output = String(maxSum);
                        passed = output === testCase.expected;
                    } else {
                        const [a, b] = testCase.input.split(' ').map(Number);
                        const result = a + b;
                        output = String(result);
                        passed = output === testCase.expected;
                    }

                    if (!passed && !isSampleTest) {
                        allPassed = false;
                    }

                    if (!isSampleTest) {
                        actualTests++;
                        if (passed) passedTests++;
                    }
                } catch (error) {
                    output = "è¿è¡Œæ—¶é”™è¯¯: " + error.message;
                    passed = false;
                    if (!isSampleTest) {
                        allPassed = false;
                        actualTests++;
                    }
                }

                results.push({
                    name: testCase.name,
                    passed: passed,
                    input: testCase.input,
                    expected: testCase.expected,
                    output: output,
                    isSampleTest: isSampleTest
                });
            });

            const executionTime = Math.floor(Math.random() * 100) + 50;

            return {
                results: results,
                allPassed: allPassed,
                executionTime: executionTime,
                switchCount: screenDetector.getSwitchCount(),
                totalTests: actualTests,
                passedTests: passedTests,
                securityViolation: false
            };
        }

        // æ˜¾ç¤ºè¯„æµ‹ç»“æœ
        function displayResults(evaluation) {
            const testResultsContainer = document.getElementById('testResults');

            testResultsContainer.innerHTML = '';

            // å®‰å…¨æ£€æŸ¥
            if (evaluation.securityViolation) {
                const securityAlert = document.createElement('div');
                securityAlert.className = 'test-case failed';
                securityAlert.innerHTML = `
                    <div class="test-case-header">
                        <div class="test-case-title">å®‰å…¨è¿è§„</div>
                        <div class="test-case-status status-failed">é˜»æ­¢</div>
                    </div>
                    <div>
                        <p><strong>åŸå› :</strong> ä»£ç å®Œæ•´æ€§æ ¡éªŒå¤±è´¥</p>
                        <p><strong>æ“ä½œ:</strong> è¯„æµ‹è¢«é˜»æ­¢</p>
                        <p style="color: #ff5252; font-weight: bold;">è¯·å‹¿å°è¯•ä¿®æ”¹ç³»ç»Ÿä»£ç ï¼</p>
                    </div>
                `;
                testResultsContainer.appendChild(securityAlert);
                document.getElementById('validationStatus').textContent = 'å®‰å…¨è¿è§„ - è¯„æµ‹æ— æ•ˆ';
                document.getElementById('validationStatus').style.color = '#ff5252';
                document.getElementById('resultsModal').style.display = 'flex';
                return;
            }

            const summary = document.createElement('div');
            summary.className = 'test-case';
            summary.innerHTML = `
                <div class="test-case-header">
                    <div class="test-case-title">æ€»ä½“ç»“æœ</div>
                    <div class="test-case-status ${evaluation.allPassed ? 'status-passed' : 'status-failed'}">
                        ${evaluation.allPassed ? 'é€šè¿‡' : 'æœªé€šè¿‡'}
                    </div>
                </div>
                <div>
                    <p><strong>æµ‹è¯•ç»Ÿè®¡:</strong> ${evaluation.passedTests}/${evaluation.totalTests} é€šè¿‡</p>
                    <p><strong>æ‰§è¡Œæ—¶é—´:</strong> ${evaluation.executionTime} ms</p>
                    <p><strong>åˆ‡å±æ¬¡æ•°:</strong> ${evaluation.switchCount} æ¬¡</p>
                    ${evaluation.switchCount >= 3 ? '<p style="color: #ff5252; font-weight: bold;">è­¦å‘Š: åˆ‡å±æ¬¡æ•°è¿‡å¤šå¯èƒ½å½±å“æˆç»©ï¼</p>' : ''}
                </div>
            `;
            testResultsContainer.appendChild(summary);

            evaluation.results.forEach(result => {
                const testCaseEl = document.createElement('div');
                testCaseEl.className = `test-case ${result.passed ? 'passed' : 'failed'}`;

                const sampleTag = result.isSampleTest ? '<span style="color: #666; font-size: 0.8em;">ï¼ˆæ ·ä¾‹æµ‹è¯•ï¼Œä¸è®¡å…¥æ­£ç¡®ç‡ï¼‰</span>' : '';

                testCaseEl.innerHTML = `
                    <div class="test-case-header">
                        <div class="test-case-title">${result.name} ${sampleTag}</div>
                        <div class="test-case-status ${result.passed ? 'status-passed' : 'status-failed'}">
                            ${result.passed ? 'é€šè¿‡' : 'å¤±è´¥'}
                        </div>
                    </div>
                    <div>
                        <p><strong>è¾“å…¥:</strong> ${result.input}</p>
                        <p><strong>æœŸæœ›è¾“å‡º:</strong> ${result.expected}</p>
                        <p><strong>å®é™…è¾“å‡º:</strong> ${result.output}</p>
                    </div>
                `;

                testResultsContainer.appendChild(testCaseEl);
            });

            // æ¨¡æ‹ŸæœåŠ¡å™¨éªŒè¯
            document.getElementById('validationStatus').textContent = 'éªŒè¯é€šè¿‡ - ç»“æœå¯ä¿¡';
            document.getElementById('validationStatus').style.color = '#4caf50';

            document.getElementById('resultsModal').style.display = 'flex';
        }

        // è¿è¡Œä»£ç æŒ‰é’®
        document.getElementById('runCode').addEventListener('click', function() {
            // å®‰å…¨æ£€æŸ¥
            if (!validateCodeIntegrity()) {
                showNotification('ä»£ç å®Œæ•´æ€§æ ¡éªŒå¤±è´¥ï¼Œæ“ä½œè¢«é˜»æ­¢', 'error');
                return;
            }

            const code = codeEditor.getValue();
            const language = document.getElementById('languageSelector').value;

            if (!code.trim()) {
                alert('è¯·è¾“å…¥ä»£ç ï¼');
                return;
            }

            if (!currentProblemId) {
                alert('è¯·å…ˆç”Ÿæˆä¸€ä¸ªé¢˜ç›®ï¼');
                return;
            }

            const originalText = this.textContent;
            this.textContent = 'è¯„æµ‹ä¸­...';
            this.disabled = true;

            setTimeout(() => {
                const evaluation = evaluateCode(code, language, currentProblemId);
                displayResults(evaluation);

                this.textContent = originalText;
                this.disabled = false;
            }, 1500);
        });

        // é‡ç½®ä»£ç æŒ‰é’®
        document.getElementById('resetCode').addEventListener('click', function() {
            if (!validateCodeIntegrity()) {
                showNotification('ä»£ç å®Œæ•´æ€§æ ¡éªŒå¤±è´¥ï¼Œæ“ä½œè¢«é˜»æ­¢', 'error');
                return;
            }

            if (confirm('ç¡®å®šè¦é‡ç½®ä»£ç å—ï¼Ÿè¿™å°†æ¢å¤ä¸ºé»˜è®¤ä»£ç ã€‚')) {
                if (currentProblemId) {
                    const problem = problems.find(p => p.id == currentProblemId);
                    if (problem) {
                        const difficulty = problem.difficulty || 1;
                        const language = document.getElementById('languageSelector').value;
                        let defaultCode = '';

                        if (language === 'c' || language === 'cpp') {
                            if (difficulty <= 3) {
                                defaultCode = `#include <stdio.h>\n\nint main() {\n    // ç®€å•é¢˜ç›®ï¼Œè¯·åœ¨æ­¤ç¼–å†™ä»£ç \n    return 0;\n}`;
                            } else if (difficulty <= 7) {
                                defaultCode = `#include <stdio.h>\n#include <stdlib.h>\n\nint main() {\n    // ä¸­ç­‰éš¾åº¦é¢˜ç›®ï¼Œå¯èƒ½éœ€è¦æ•°ç»„æˆ–å­—ç¬¦ä¸²å¤„ç†\n    return 0;\n}`;
                            } else {
                                defaultCode = `#include <stdio.h>\n#include <stdlib.h>\n#include <string.h>\n\nint main() {\n    // é«˜éš¾åº¦é¢˜ç›®ï¼Œå¯èƒ½éœ€è¦å¤æ‚ç®—æ³•\n    return 0;\n}`;
                            }
                        } else if (language === 'python') {
                            if (difficulty <= 3) {
                                defaultCode = `# ç®€å•é¢˜ç›®ï¼Œè¯·åœ¨æ­¤ç¼–å†™ä»£ç `;
                            } else if (difficulty <= 7) {
                                defaultCode = `# ä¸­ç­‰éš¾åº¦é¢˜ç›®ï¼Œå¯èƒ½éœ€è¦åˆ—è¡¨æˆ–å­—å…¸å¤„ç†`;
                            } else {
                                defaultCode = `# é«˜éš¾åº¦é¢˜ç›®ï¼Œå¯èƒ½éœ€è¦å¤æ‚ç®—æ³•`;
                            }
                        } else if (language === 'java') {
                            defaultCode = `public class Main {\n    public static void main(String[] args) {\n        // è¯·åœ¨æ­¤ç¼–å†™ä»£ç \n    }\n}`;
                        }

                        codeEditor.setValue(defaultCode);
                    }
                } else {
                    codeEditor.setValue(`#include <stdio.h>\n\nint main() {\n    // è¯·åœ¨æ­¤ç¼–å†™ä»£ç \n    return 0;\n}`);
                }

                document.getElementById('resultsModal').style.display = 'none';

                // æ›´æ–°ä»£ç å®Œæ•´æ€§å“ˆå¸Œ
                securityState.lastCodeHash = calculateCodeIntegrity();
            }
        });

        // æ¸…ç©ºä»£ç æŒ‰é’®
        document.getElementById('clearCode').addEventListener('click', function() {
            if (!validateCodeIntegrity()) {
                showNotification('ä»£ç å®Œæ•´æ€§æ ¡éªŒå¤±è´¥ï¼Œæ“ä½œè¢«é˜»æ­¢', 'error');
                return;
            }

            if (confirm('ç¡®å®šè¦æ¸…ç©ºä»£ç ç¼–è¾‘å™¨å—ï¼Ÿ')) {
                codeEditor.setValue('');
                securityState.lastCodeHash = calculateCodeIntegrity();
            }
        });

        // æ ¡éªŒå®Œæ•´æ€§æŒ‰é’®
        document.getElementById('validateCode').addEventListener('click', function() {
            if (validateCodeIntegrity()) {
                showNotification('ä»£ç å®Œæ•´æ€§æ ¡éªŒé€šè¿‡', 'success');
            } else {
                showNotification('ä»£ç å®Œæ•´æ€§æ ¡éªŒå¤±è´¥', 'error');
            }
        });

        // AIç”Ÿæˆé¢˜ç›®æŒ‰é’®
        document.getElementById('generateAIProblemBtn').addEventListener('click', function() {
            generateAIProblem();
        });

        // æ‰‹åŠ¨æ·»åŠ é¢˜ç›®æŒ‰é’®
        document.getElementById('addProblemBtn').addEventListener('click', function() {
            if (!validateCodeIntegrity()) {
                showNotification('ä»£ç å®Œæ•´æ€§æ ¡éªŒå¤±è´¥ï¼Œæ“ä½œè¢«é˜»æ­¢', 'error');
                return;
            }

            document.getElementById('problemForm').reset();
            document.getElementById('addProblemModal').style.display = 'flex';
        });

        // å…³é—­æ·»åŠ é¢˜ç›®æ¨¡æ€æ¡†
        document.getElementById('closeAddProblemModal').addEventListener('click', function() {
            document.getElementById('addProblemModal').style.display = 'none';
        });

        document.getElementById('cancelAddProblem').addEventListener('click', function() {
            document.getElementById('addProblemModal').style.display = 'none';
        });

        // å¤„ç†æ‰‹åŠ¨æ·»åŠ é¢˜ç›®è¡¨å•æäº¤
        document.getElementById('problemForm').addEventListener('submit', function(e) {
            e.preventDefault();

            if (!validateCodeIntegrity()) {
                showNotification('ä»£ç å®Œæ•´æ€§æ ¡éªŒå¤±è´¥ï¼Œæ“ä½œè¢«é˜»æ­¢', 'error');
                return;
            }

            const newProblemId = problems.length > 0 ? Math.max(...problems.map(p => p.id)) + 1 : 2;

            let testCases = [];
            const testCasesText = document.getElementById('problemTestCases').value.trim();

            if (testCasesText) {
                try {
                    testCases = JSON.parse(testCasesText);
                } catch (error) {
                    alert('æµ‹è¯•ç”¨ä¾‹æ ¼å¼é”™è¯¯ï¼Œè¯·ä½¿ç”¨æ­£ç¡®çš„JSONæ ¼å¼ï¼');
                    return;
                }
            } else {
                testCases = [
                    { input: "1 2", expected: "3", name: "æ ·ä¾‹æµ‹è¯•" },
                    { input: "0 0", expected: "0", name: "é›¶æµ‹è¯•" },
                    { input: "10 20", expected: "30", name: "åŸºç¡€æµ‹è¯•" }
                ];
            }

            const difficulty = parseInt(document.getElementById('problemDifficultyManual').value) || 5;

            const newProblem = {
                id: newProblemId,
                title: document.getElementById('problemName').value,
                description: document.getElementById('problemDescription').value,
                inputFormat: document.getElementById('problemInputFormat').value,
                outputFormat: document.getElementById('problemOutputFormat').value,
                sampleInput: document.getElementById('problemSampleInput').value,
                sampleOutput: document.getElementById('problemSampleOutput').value,
                constraints: document.getElementById('problemConstraints').value || "æ— ç‰¹æ®Šçº¦æŸæ¡ä»¶",
                difficulty: difficulty,
                aiGenerated: false,
                testCases: testCases
            };

            problems.push(newProblem);
            initializeProblemList();
            loadProblem(newProblemId);
            document.getElementById('addProblemModal').style.display = 'none';

            showNotification(`é¢˜ç›® "${newProblem.title}" æ·»åŠ æˆåŠŸï¼`, 'success');
        });

        // å…¨å±æ¨¡å¼æŒ‰é’®
        document.getElementById('fullscreenBtn').addEventListener('click', function() {
            if (!validateCodeIntegrity()) {
                showNotification('ä»£ç å®Œæ•´æ€§æ ¡éªŒå¤±è´¥ï¼Œæ“ä½œè¢«é˜»æ­¢', 'error');
                return;
            }

            const elem = document.documentElement;

            if (!document.fullscreenElement) {
                if (elem.requestFullscreen) {
                    elem.requestFullscreen();
                } else if (elem.webkitRequestFullscreen) {
                    elem.webkitRequestFullscreen();
                } else if (elem.msRequestFullscreen) {
                    elem.msRequestFullscreen();
                }
                this.textContent = 'é€€å‡ºå…¨å±';
            } else {
                if (document.exitFullscreen) {
                    document.exitFullscreen();
                } else if (document.webkitExitFullscreen) {
                    document.webkitExitFullscreen();
                } else if (document.msExitFullscreen) {
                    document.msExitFullscreen();
                }
                this.textContent = 'å…¨å±æ¨¡å¼';
            }
        });

        // ç›‘å¬å…¨å±å˜åŒ–
        document.addEventListener('fullscreenchange', handleFullscreenChange);
        document.addEventListener('webkitfullscreenchange', handleFullscreenChange);
        document.addEventListener('mozfullscreenchange', handleFullscreenChange);

        function handleFullscreenChange() {
            const isFullscreen = document.fullscreenElement ||
                                document.webkitFullscreenElement ||
                                document.mozFullScreenElement;

            if (!isFullscreen) {
                document.getElementById('fullscreenBtn').textContent = 'å…¨å±æ¨¡å¼';
            }
        }

        // é¡µé¢åŠ è½½å®Œæˆæ—¶åˆå§‹åŒ–
        window.addEventListener('load', function() {
            // åˆå§‹åŒ–å®‰å…¨ç³»ç»Ÿ
            initSecuritySystem();

            // æ·»åŠ é»˜è®¤çš„A+Bé—®é¢˜
            const defaultProblem = {
                id: 1,
                title: "A + B é—®é¢˜",
                description: "ç»™å®šä¸¤ä¸ªæ•´æ•°Aå’ŒBï¼Œè¯·è®¡ç®—å®ƒä»¬çš„å’Œã€‚è¿™æ˜¯æœ€åŸºæœ¬çš„ç¼–ç¨‹å…¥é—¨é¢˜ç›®ã€‚",
                inputFormat: "è¾“å…¥åŒ…å«ä¸¤ä¸ªæ•´æ•°Aå’ŒBï¼Œç”¨ç©ºæ ¼åˆ†éš”ã€‚",
                outputFormat: "è¾“å‡ºä¸€ä¸ªæ•´æ•°ï¼Œè¡¨ç¤ºA+Bçš„ç»“æœã€‚",
                sampleInput: "1 2",
                sampleOutput: "3",
                constraints: "-1000 â‰¤ A, B â‰¤ 1000",
                difficulty: 1,
                aiGenerated: false,
                testCases: [
                    { input: "1 2", expected: "3", name: "æ ·ä¾‹æµ‹è¯•" },
                    { input: "0 0", expected: "0", name: "é›¶æµ‹è¯•" },
                    { input: "-5 10", expected: "5", name: "è´Ÿæ•°æµ‹è¯•" },
                    { input: "100 200", expected: "300", name: "è¾ƒå¤§æ•°å€¼" },
                    { input: "-100 -200", expected: "-300", name: "åŒè´Ÿæ•°æµ‹è¯•" }
                ]
            };

            problems = [defaultProblem];
            currentProblemId = 1;

            initializeProblemList();
            loadProblem(1);
            codeEditor.focus();

            // å®‰å…¨è­¦å‘Š
            console.log('%cå®‰å…¨è­¦å‘Š', 'color: red; font-size: 20px; font-weight: bold;');
            console.log('%cæ­¤ç³»ç»Ÿå—å®‰å…¨ä¿æŠ¤ï¼Œä»»ä½•ç¯¡æ”¹è¡Œä¸ºå°†è¢«è®°å½•å¹¶ä¸ŠæŠ¥ï¼', 'color: orange; font-size: 14px;');
        });
    </script>
</body>
</html>